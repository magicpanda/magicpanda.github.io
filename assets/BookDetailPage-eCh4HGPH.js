import{t as e}from"./function-call-C-X9mcip.js";import{a as t,i as n,l as r,m as i,n as a,p as o,t as s,u as c}from"./_plugin-vue_export-helper-BGPu65u-.js";import{t as l}from"./image-B9YxNmEL.js";import{A as u,At as d,B as f,C as p,Dt as m,Et as h,I as g,J as _,L as v,M as y,N as b,Nt as x,O as S,P as C,R as w,S as T,T as E,V as D,X as O,Y as k,_t as A,at as j,c as M,ct as N,dt as P,ft as F,g as I,gt as ee,ht as L,it as R,j as te,jt as z,k as B,kt as V,l as H,m as ne,mt as U,ot as W,p as re,s as ie,st as G,t as ae,ut as K,v as q,vt as oe,w as se,wt as J,x as ce,xt as Y,yt as X,z as Z}from"./index-Cx_W_gHZ.js";var[le,Q]=I(`swipe`),ue={loop:f,width:Z,height:Z,vertical:Boolean,autoplay:g(0),duration:g(500),touchable:f,lazyRender:Boolean,initialSwipe:g(0),indicatorColor:String,showIndicators:f,stopPropagation:f},de=Symbol(le),fe=M(F({name:le,props:ue,emits:[`change`,`dragStart`,`dragEnd`],setup(e,{emit:t,slots:n}){let r=d(),a=d(),o=V({rect:null,width:0,height:0,offset:0,active:0,swiping:!1}),s=!1,l=c(),{children:f,linkChildren:m}=B(de),g=R(()=>f.length),_=R(()=>o[e.vertical?`height`:`width`]),v=R(()=>e.vertical?l.deltaY.value:l.deltaX.value),y=R(()=>o.rect?(e.vertical?o.rect.height:o.rect.width)-_.value*g.value:0),b=R(()=>_.value?Math.ceil(Math.abs(y.value)/_.value):g.value),x=R(()=>g.value*_.value),S=R(()=>(o.active+g.value)%g.value),C=R(()=>{let t=e.vertical?`vertical`:`horizontal`;return l.direction.value===t}),w=R(()=>{let t={transitionDuration:`${o.swiping?0:e.duration}ms`,transform:`translate${e.vertical?`Y`:`X`}(${+o.offset.toFixed(2)}px)`};if(_.value){let n=e.vertical?`height`:`width`,r=e.vertical?`width`:`height`;t[n]=`${x.value}px`,t[r]=e[r]?`${e[r]}px`:``}return t}),D=t=>{let{active:n}=o;return t?e.loop?q(n+t,-1,g.value):q(n+t,0,b.value):n},O=(t,n=0)=>{let r=t*_.value;e.loop||(r=Math.min(r,-y.value));let i=n-r;return e.loop||(i=q(i,y.value,0)),i},k=({pace:n=0,offset:r=0,emitChange:i})=>{if(g.value<=1)return;let{active:a}=o,s=D(n),c=O(s,r);if(e.loop){if(f[0]&&c!==y.value){let e=c<y.value;f[0].setOffset(e?x.value:0)}if(f[g.value-1]&&c!==0){let e=c>0;f[g.value-1].setOffset(e?-x.value:0)}}o.active=s,o.offset=c,i&&s!==a&&t(`change`,S.value)},j=()=>{o.swiping=!0,o.active<=-1?k({pace:g.value}):o.active>=g.value&&k({pace:-g.value})},M=()=>{j(),l.reset(),E(()=>{o.swiping=!1,k({pace:-1,emitChange:!0})})},N=()=>{j(),l.reset(),E(()=>{o.swiping=!1,k({pace:1,emitChange:!0})})},F,I=()=>clearTimeout(F),z=()=>{I(),+e.autoplay>0&&g.value>1&&(F=setTimeout(()=>{N(),z()},+e.autoplay))},H=(t=+e.initialSwipe)=>{if(!r.value)return;let n=()=>{if(!ce(r)){let t={width:r.value.offsetWidth,height:r.value.offsetHeight};o.rect=t,o.width=+(e.width??t.width),o.height=+(e.height??t.height)}g.value&&(t=Math.min(g.value-1,t),t===-1&&(t=g.value-1)),o.active=t,o.swiping=!0,o.offset=O(t),f.forEach(e=>{e.setOffset(0)}),z()};ce(r)?L().then(n):n()},ne=()=>H(o.active),U,W=t=>{!e.touchable||t.touches.length>1||(l.start(t),s=!1,U=Date.now(),I(),j())},re=n=>{e.touchable&&o.swiping&&(l.move(n),C.value&&(!e.loop&&(o.active===0&&v.value>0||o.active===g.value-1&&v.value<0)||(T(n,e.stopPropagation),k({offset:v.value}),s||=(t(`dragStart`,{index:S.value}),!0))))},G=()=>{if(!e.touchable||!o.swiping)return;let n=Date.now()-U,r=v.value/n;if((Math.abs(r)>.25||Math.abs(v.value)>_.value/2)&&C.value){let t=e.vertical?l.offsetY.value:l.offsetX.value,n=0;n=e.loop?t>0?v.value>0?-1:1:0:-Math[v.value>0?`ceil`:`floor`](v.value/_.value),k({pace:n,emitChange:!0})}else v.value&&k({pace:0});s=!1,o.swiping=!1,t(`dragEnd`,{index:S.value}),z()},ae=(t,n={})=>{j(),l.reset(),E(()=>{let r;r=e.loop&&t===g.value?o.active===0?0:t:t%g.value,n.immediate?E(()=>{o.swiping=!1}):o.swiping=!1,k({pace:r-o.active,emitChange:!0})})},K=(t,n)=>{let r=n===S.value;return P(`i`,{style:r?{backgroundColor:e.indicatorColor}:void 0,class:Q(`indicator`,{active:r})},null)},J=()=>{if(n.indicator)return n.indicator({active:S.value,total:g.value});if(e.showIndicators&&g.value>1)return P(`div`,{class:Q(`indicators`,{vertical:e.vertical})},[Array(g.value).fill(``).map(K)])};return i({prev:M,next:N,state:o,resize:ne,swipeTo:ae}),m({size:_,props:e,count:g,activeIndicator:S}),h(()=>e.initialSwipe,e=>H(+e)),h(g,()=>H(o.active)),h(()=>e.autoplay,z),h([se,p,()=>e.width,()=>e.height],ne),h(te(),e=>{e===`visible`?z():I()}),X(H),ee(()=>H(o.active)),ie(()=>H(o.active)),oe(I),A(I),u(`touchmove`,re,{target:a}),()=>P(`div`,{ref:r,class:Q()},[P(`div`,{ref:a,style:w.value,class:Q(`track`,{vertical:e.vertical}),onTouchstartPassive:W,onTouchend:G,onTouchcancel:G},[n.default?.call(n)]),J()])}})),[pe,me]=I(`swipe-item`),he=M(F({name:pe,setup(e,{slots:t}){let n,r=V({offset:0,inited:!1,mounted:!1}),{parent:a,index:o}=y(de);if(!a)return;let s=R(()=>{let e={},{vertical:t}=a.props;return a.size.value&&(e[t?`height`:`width`]=`${a.size.value}px`),r.offset&&(e.transform=`translate${t?`Y`:`X`}(${r.offset}px)`),e}),c=R(()=>{let{loop:e,lazyRender:t}=a.props;if(!t||n)return!0;if(!r.mounted)return!1;let i=a.activeIndicator.value,s=a.count.value-1,c=i===0&&e?s:i-1,l=i===s&&e?0:i+1;return n=o.value===i||o.value===c||o.value===l,n});return X(()=>{L(()=>{r.mounted=!0})}),i({setOffset:e=>{r.offset=e}}),()=>P(`div`,{class:me(),style:s.value},[c.value?t.default?.call(t):null])}})),ge=e=>Math.sqrt((e[0].clientX-e[1].clientX)**2+(e[0].clientY-e[1].clientY)**2),_e=e=>({x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}),ve=I(`image-preview`)[1],ye=2.6,be=F({props:{src:String,show:Boolean,active:Number,minZoom:v(Z),maxZoom:v(Z),rootWidth:v(Number),rootHeight:v(Number),disableZoom:Boolean,doubleScale:Boolean,closeOnClickImage:Boolean,closeOnClickOverlay:Boolean,vertical:Boolean},emits:[`scale`,`close`,`longPress`],setup(e,{emit:t,slots:n}){let r=V({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,initializing:!1,imageRatio:0}),a=c(),s=d(),f=d(),p=d(!1),m=d(!1),g=0,_=R(()=>{let{scale:e,moveX:t,moveY:n,moving:i,zooming:a,initializing:o}=r,s={transitionDuration:a||i||o?`0s`:`.3s`};return(e!==1||m.value)&&(s.transform=`matrix(${e}, 0, 0, ${e}, ${t}, ${n})`),s}),v=R(()=>{if(r.imageRatio){let{rootWidth:t,rootHeight:n}=e,i=p.value?n/r.imageRatio:t;return Math.max(0,(r.scale*i-t)/2)}return 0}),y=R(()=>{if(r.imageRatio){let{rootWidth:t,rootHeight:n}=e,i=p.value?n:t*r.imageRatio;return Math.max(0,(r.scale*i-n)/2)}return 0}),x=(n,i)=>{if(n=q(n,+e.minZoom,+e.maxZoom+1),n!==r.scale){let a=n/r.scale;if(r.scale=n,i){let e=b(s.value?.$el),t={x:e.width*.5,y:e.height*.5},n=r.moveX-(i.x-e.left-t.x)*(a-1),o=r.moveY-(i.y-e.top-t.y)*(a-1);r.moveX=q(n,-v.value,v.value),r.moveY=q(o,-y.value,y.value)}else r.moveX=0,r.moveY=m.value?g:0;t(`scale`,{scale:n,index:e.active})}},C=()=>{x(1)},w=()=>{let e=r.scale>1?1:2;x(e,e===2||m.value?{x:a.startX.value,y:a.startY.value}:void 0)},E,D,O,k,A,j,M,N,F=!1,I=t=>{let{touches:n}=t;if(E=n.length,E===2&&e.disableZoom)return;let{offsetX:i}=a;a.start(t),D=r.moveX,O=r.moveY,N=Date.now(),F=!1,r.moving=E===1&&(r.scale!==1||m.value),r.zooming=E===2&&!i.value,r.zooming&&(k=r.scale,A=ge(n))},ee=t=>{let{touches:n}=t;if(a.move(t),r.moving){let{deltaX:n,deltaY:i}=a,o=n.value+D,s=i.value+O;if((e.vertical?a.isVertical()&&Math.abs(s)>y.value:a.isHorizontal()&&Math.abs(o)>v.value)&&!F){r.moving=!1;return}F=!0,T(t,!0),r.moveX=q(o,-v.value,v.value),r.moveY=q(s,-y.value,y.value)}if(r.zooming&&(T(t,!0),n.length===2)){let e=ge(n),t=k*e/A;j=_e(n),x(t,j)}},L=n=>{let r=f.value?.$el;if(!r)return;let i=r.firstElementChild,a=n.target===r,o=i?.contains(n.target);!e.closeOnClickImage&&o||!e.closeOnClickOverlay&&a||t(`close`)},te=n=>{if(E>1)return;let r=Date.now()-N;a.isTap.value&&(r<250?e.doubleScale?M?(clearTimeout(M),M=null,w()):M=setTimeout(()=>{L(n),M=null},250):L(n):r>500&&t(`longPress`))},z=t=>{let n=!1;if((r.moving||r.zooming)&&(n=!0,r.moving&&D===r.moveX&&O===r.moveY&&(n=!1),!t.touches.length)){r.zooming&&=(r.moveX=q(r.moveX,-v.value,v.value),r.moveY=q(r.moveY,-y.value,y.value),!1),r.moving=!1,D=0,O=0,k=1,r.scale<1&&C();let t=+e.maxZoom;r.scale>t&&x(t,j)}T(t,n),te(t),a.reset()},B=()=>{let{rootWidth:t,rootHeight:n}=e,i=n/t,{imageRatio:a}=r;p.value=r.imageRatio>i&&a<ye,m.value=r.imageRatio>i&&a>=ye,m.value&&(g=(a*t-n)/2,r.moveY=g,r.initializing=!0,S(()=>{r.initializing=!1})),C()},H=e=>{let{naturalWidth:t,naturalHeight:n}=e.target;r.imageRatio=n/t,B()};return h(()=>e.active,C),h(()=>e.show,e=>{e||C()}),h(()=>[e.rootWidth,e.rootHeight],B),u(`touchmove`,ee,{target:R(()=>f.value?.$el)}),i({resetScale:C}),()=>{let t={loading:()=>P(o,{type:`spinner`},null)};return P(he,{ref:f,class:ve(`swipe-item`),onTouchstartPassive:I,onTouchend:z,onTouchcancel:z},{default:()=>[n.image?P(`div`,{class:ve(`image-wrap`)},[n.image({src:e.src,onLoad:H,style:_.value})]):P(l,{ref:s,src:e.src,fit:`contain`,class:ve(`image`,{vertical:p.value}),style:_.value,onLoad:H},t)]})}}}),[xe,$]=I(`image-preview`),Se=[`show`,`teleport`,`transition`,`overlayStyle`,`closeOnPopstate`],Ce=M(F({name:xe,props:{show:Boolean,loop:f,images:C(),minZoom:g(1/3),maxZoom:g(3),overlay:f,vertical:Boolean,closeable:Boolean,showIndex:f,className:null,closeIcon:w(`clear`),transition:String,beforeClose:Function,doubleScale:f,overlayClass:null,overlayStyle:Object,swipeDuration:g(300),startPosition:g(0),showIndicators:Boolean,closeOnPopstate:f,closeOnClickImage:f,closeOnClickOverlay:f,closeIconPosition:w(`top-right`),teleport:[String,Object]},emits:[`scale`,`close`,`closed`,`change`,`longPress`,`update:show`],setup(e,{emit:t,slots:n}){let a=d(),o=d(),s=V({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),c=()=>{if(a.value){let e=b(a.value.$el);s.rootWidth=e.width,s.rootHeight=e.height,a.value.resize()}},l=e=>t(`scale`,e),u=e=>t(`update:show`,e),f=()=>{H(e.beforeClose,{args:[s.active],done:()=>u(!1)})},m=e=>{e!==s.active&&(s.active=e,t(`change`,e))},g=()=>{if(e.showIndex)return P(`div`,{class:$(`index`)},[n.index?n.index({index:s.active}):`${s.active+1} / ${e.images.length}`])},v=()=>{if(n.cover)return P(`div`,{class:$(`cover`)},[n.cover()])},y=()=>{s.disableZoom=!0},x=()=>{s.disableZoom=!1},S=()=>P(fe,{ref:a,lazyRender:!0,loop:e.loop,class:$(`swipe`),vertical:e.vertical,duration:e.swipeDuration,initialSwipe:e.startPosition,showIndicators:e.showIndicators,indicatorColor:`white`,onChange:m,onDragEnd:x,onDragStart:y},{default:()=>[e.images.map((r,i)=>P(be,{ref:e=>{i===s.active&&(o.value=e)},src:r,show:e.show,active:s.active,maxZoom:e.maxZoom,minZoom:e.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,doubleScale:e.doubleScale,closeOnClickImage:e.closeOnClickImage,closeOnClickOverlay:e.closeOnClickOverlay,vertical:e.vertical,onScale:l,onClose:f,onLongPress:()=>t(`longPress`,{index:i})},{image:n.image}))]}),C=()=>{if(e.closeable)return P(ae,{role:`button`,name:e.closeIcon,class:[$(`close-icon`,e.closeIconPosition),re],onClick:f},null)},w=()=>t(`closed`),T=(e,t)=>a.value?.swipeTo(e,t);return i({resetScale:()=>{var e;(e=o.value)==null||e.resetScale()},swipeTo:T}),X(c),h([se,p],c),h(()=>e.startPosition,e=>m(+e)),h(()=>e.show,n=>{let{images:r,startPosition:i}=e;n?(m(+i),L(()=>{c(),T(+i,{immediate:!0})})):t(`close`,{index:s.active,url:r[s.active]})}),()=>P(r,U({class:[$(),e.className],overlayClass:[$(`overlay`),e.overlayClass],onClosed:w,"onUpdate:show":u},_(e,Se)),{default:()=>[C(),S(),g(),v()]})}})),we={class:`book-detail-page`},Te={class:`content`},Ee={key:2,class:`book-detail`},De={class:`book-header`},Oe={class:`book-meta`},ke={class:`book-title`},Ae={class:`book-authors`},je={class:`status-tags`},Me={class:`book-description`},Ne={class:`action-buttons`},Pe=s({__name:`BookDetailPage`,setup(r){let i=k(),o=O(),s=a(),c=d(!0),u=i.params.id,f=R(()=>s.getBookById(u)),p=e=>!e||e.length===0?`未知作者`:e.join(`, `),h=e=>e?new Date(e).toLocaleDateString(`zh-CN`,{year:`numeric`,month:`2-digit`,day:`2-digit`}):`未知`,g=e=>({unread:`default`,reading:`primary`,finished:`success`})[e]||`default`,_=e=>({unread:`未读`,reading:`在读`,finished:`已读`})[e]||`未知`,v=e=>({on_shelf:`success`,lent_out:`warning`,lost:`danger`})[e]||`default`,y=e=>({on_shelf:`在架`,lent_out:`借出`,lost:`丢失`})[e]||`未知`,b=()=>{f.value&&f.value.coverImage&&Ce([f.value.coverImage])},S=()=>{o.back()},C=()=>{o.push(`/book/${u}/edit`)},w=()=>{e({title:`确认删除`,message:`确定要删除《${f.value.title}》吗？此操作不可恢复。`,showCancelButton:!0,confirmButtonText:`删除`,confirmButtonColor:`#ee0a24`}).then(async()=>{await T()}).catch(()=>{})},T=async()=>{let e=await s.deleteBook(u);e.success?(t(`删除成功`),setTimeout(()=>{o.push(`/`)},500)):n(e.error||`删除失败`)};return X(async()=>{s.books.length===0&&await s.loadBooks(),c.value=!1,f.value||console.error(`Book not found:`,u)}),(e,t)=>{let n=J(`van-icon`),r=J(`van-nav-bar`),i=J(`van-loading`),a=J(`van-button`),o=J(`van-empty`),s=J(`van-tag`),u=J(`van-cell`),d=J(`van-cell-group`);return Y(),N(`div`,we,[P(r,{title:`图书详情`,"left-arrow":``,fixed:``,onClickLeft:S},{right:m(()=>[P(n,{name:`edit`,size:`18`,onClick:C})]),_:1}),j(`div`,Te,[c.value?(Y(),W(i,{key:0,class:`loading`,size:`24px`,vertical:``},{default:m(()=>[...t[0]||=[K(` 正在加载... `,-1)]]),_:1})):f.value?(Y(),N(`div`,Ee,[j(`div`,De,[P(z(l),{src:f.value.coverImage,fit:`cover`,class:`book-cover`,onClick:b},{loading:m(()=>[P(i,{type:`spinner`,size:`20`})]),error:m(()=>[P(n,{name:`photo-fail`,size:`48`})]),_:1},8,[`src`]),j(`div`,Oe,[j(`h1`,ke,x(f.value.title),1),j(`div`,Ae,x(p(f.value.authors)),1),j(`div`,je,[P(s,{type:g(f.value.readingStatus),size:`medium`},{default:m(()=>[K(x(_(f.value.readingStatus)),1)]),_:1},8,[`type`]),P(s,{type:v(f.value.collectionStatus),size:`medium`},{default:m(()=>[K(x(y(f.value.collectionStatus)),1)]),_:1},8,[`type`]),f.value.bookType?(Y(),W(s,{key:0,type:`primary`,size:`medium`},{default:m(()=>[K(x(f.value.bookType),1)]),_:1})):G(``,!0)])])]),P(d,{inset:``,title:`基本信息`},{default:m(()=>[P(u,{title:`ISBN`,value:f.value.isbn},null,8,[`value`]),P(u,{title:`出版社`,value:f.value.publisher||`未知`},null,8,[`value`]),P(u,{title:`出版日期`,value:f.value.publishedDate||`未知`},null,8,[`value`]),P(u,{title:`页数`,value:f.value.pageCount?`${f.value.pageCount}页`:`未知`},null,8,[`value`]),P(u,{title:`添加日期`,value:h(f.value.addedDate)},null,8,[`value`])]),_:1}),P(d,{inset:``,title:`内容简介`},{default:m(()=>[P(u,null,{default:m(()=>[j(`div`,Me,x(f.value.description||`暂无简介`),1)]),_:1})]),_:1}),f.value.purchaseInfo?(Y(),W(d,{key:0,inset:``,title:`购书信息`},{default:m(()=>[P(u,{title:`购买日期`,value:h(f.value.purchaseInfo.date)},null,8,[`value`]),P(u,{title:`购买价格`,value:`¥${f.value.purchaseInfo.price}`},null,8,[`value`]),P(u,{title:`购买渠道`,value:f.value.purchaseInfo.source},null,8,[`value`])]),_:1})):G(``,!0),j(`div`,Ne,[P(a,{type:`primary`,size:`large`,block:``,icon:`edit`,onClick:C},{default:m(()=>[...t[2]||=[K(` 编辑图书 `,-1)]]),_:1}),P(a,{type:`danger`,size:`large`,block:``,icon:`delete-o`,onClick:w},{default:m(()=>[...t[3]||=[K(` 删除图书 `,-1)]]),_:1})])])):(Y(),W(o,{key:1,image:`error`,description:`未找到该图书`},{default:m(()=>[P(a,{type:`primary`,onClick:S},{default:m(()=>[...t[1]||=[K(`返回`,-1)]]),_:1})]),_:1}))])])}}},[[`__scopeId`,`data-v-4d6dfe5f`]]);export{Pe as default};