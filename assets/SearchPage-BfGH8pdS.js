import{t as e}from"./search-D10Z0bcx.js";import{a as t,i as n,n as r,o as i,r as a,t as o}from"./plugin-vue_export-helper.js";import{At as s,Ct as ee,Dt as c,Mt as te,Nt as l,Ot as ne,X as re,Y as ie,at as u,ct as d,dt as f,et as p,jt as m,lt as h,nt as g,st as _,tt as ae,ut as v,wt as y,xt as b,yt as oe}from"./index-Cx_W_gHZ.js";var se={class:`search-page`},x={class:`content`},S={class:`quick-actions`},C={class:`isbn-input-wrapper`},w={key:0,class:`loading-container`},T={key:1,class:`error-container`},E={key:2,class:`result-container`},D={class:`result-card`},O={class:`book-cover-wrapper`},k=[`src`,`alt`],A={class:`book-info`},j={class:`book-title`},M={class:`book-meta`},N={class:`meta-item`},P={class:`meta-item`},F={class:`meta-item`},I={class:`isbn-tag`},L={class:`isbn-value`},R={key:0,class:`book-description`},z={class:`action-buttons`},B={key:3,class:`empty-container`},V={class:`tips-section`},H={class:`tip-item`},U={class:`tip-item`},ce={class:`debug-section`},W={class:`debug-content`},G={key:0,class:`debug-item`},le={key:1,class:`debug-item`},ue={class:`debug-value logs`},de={key:2,class:`debug-item`},fe={class:`debug-value url`},pe={key:3,class:`debug-item`},me={class:`debug-value`},he={key:4,class:`debug-item`},ge={class:`debug-value json`},K=o({__name:`SearchPage`,setup(o){let K=re(),_e=ie(),q=e(),J=r(),Y=s(``),X=s(!1),Z=s(!1),Q=s(!1);oe(async()=>{let e=_e.query.isbn;e&&(Y.value=e,console.log(`æ¥æ”¶åˆ°æ‰«ç ISBN:`,e),K.replace({query:{}}),(await q.searchByISBN(e)).success&&(console.log(`è‡ªåŠ¨æŸ¥è¯¢æˆåŠŸ`),Z.value=!1))});let ve=e=>!e||e.length===0?`æœªçŸ¥ä½œè€…`:e.join(`, `),ye=e=>e===`confirm`?$():!0,$=async()=>{let e=Y.value.trim();return e?/^\d{10}(\d{3})?$/.test(e)?(X.value=!1,q.clearError(),(await q.searchByISBN(e)).success&&(t(`æŸ¥è¯¢æˆåŠŸ`),Z.value=!1),!0):(i(`ISBNæ ¼å¼ä¸æ­£ç¡®`),!1):(i(`è¯·è¾“å…¥ISBNç¼–å·`),!1)},be=()=>{Y.value.trim()?$():X.value=!0},xe=()=>{K.push(`/scan`)},Se=e=>{e.target.dataset.errorHandled?e.target.src=`data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="300"%3E%3Crect width="200" height="300" fill="%23f0f0f0"/%3E%3Ctext x="50%25" y="50%25" text-anchor="middle" dy=".3em" fill="%23999" font-size="16"%3Eæš‚æ— å°é¢%3C/text%3E%3C/svg%3E`:(e.target.dataset.errorHandled=`true`,e.target.src=`/default-book-cover.png`)},Ce=async()=>{if(!q.result)return;console.log(`ğŸ“š å‡†å¤‡æ·»åŠ å›¾ä¹¦åˆ°Firebase`),console.log(`åŸå§‹å›¾ä¹¦æ•°æ®:`,q.result);let e=await a.bookExists(q.result.isbn);if(e.success&&e.data){n(`è¯¥å›¾ä¹¦å·²åœ¨å›¾ä¹¦é¦†ä¸­`);return}let r={...q.result,collectionStatus:`on_shelf`,readingStatus:`unread`,bookType:``,purchaseInfo:null,addedDate:new Date().toISOString(),updatedDate:new Date().toISOString()};console.log(`å®Œæ•´å›¾ä¹¦æ•°æ®ï¼ˆå°†ä¿å­˜åˆ°Firebaseï¼‰:`,r),console.log(`æ•°æ®å­—æ®µæ£€æŸ¥:`),console.log(`- ISBN:`,r.isbn),console.log(`- æ ‡é¢˜:`,r.title),console.log(`- ä½œè€…:`,r.authors),console.log(`- å‡ºç‰ˆç¤¾:`,r.publisher),console.log(`- å‡ºç‰ˆæ—¥æœŸ:`,r.publishedDate),console.log(`- ç®€ä»‹é•¿åº¦:`,r.description?.length),console.log(`- å°é¢:`,r.coverImage),console.log(`- é¡µæ•°:`,r.pageCount);let i=await J.addBook(r);i.success?(console.log(`âœ… å›¾ä¹¦å·²æˆåŠŸæ·»åŠ åˆ°Firebase`),t(`æ·»åŠ æˆåŠŸï¼`),q.clearResult(),Y.value=``,Z.value=!1,setTimeout(()=>{K.push(`/library`)},1500)):(console.error(`âŒ æ·»åŠ å›¾ä¹¦å¤±è´¥:`,i.error),n(i.error||`æ·»åŠ å¤±è´¥`))};return(e,t)=>{let n=y(`van-icon`),r=y(`van-field`),i=y(`van-dialog`),a=y(`van-loading`),o=y(`van-button`),s=y(`van-empty`);return b(),d(`div`,se,[t[22]||=h(`<div class="header-decoration" data-v-554498cc><div class="header-content" data-v-554498cc><div class="app-icon" data-v-554498cc>ğŸ“š</div><h1 class="app-title" data-v-554498cc>å®¶åº­å›¾ä¹¦é¦†</h1><p class="app-subtitle" data-v-554498cc>è½»æ¾ç®¡ç†æ‚¨çš„è—ä¹¦</p></div></div>`,1),u(`div`,x,[u(`div`,S,[u(`div`,{class:`action-card scan-card`,onClick:xe},[t[5]||=u(`div`,{class:`card-icon`},`ğŸ“·`,-1),t[6]||=u(`div`,{class:`card-content`},[u(`div`,{class:`card-title`},`æ‰«ç å½•å…¥`),u(`div`,{class:`card-desc`},`æ‰«æå›¾ä¹¦æ¡å½¢ç `)],-1),f(n,{name:`arrow`,class:`card-arrow`})]),u(`div`,{class:`action-card isbn-card`,onClick:t[0]||=e=>X.value=!0},[t[7]||=u(`div`,{class:`card-icon`},`ğŸ”`,-1),t[8]||=u(`div`,{class:`card-content`},[u(`div`,{class:`card-title`},`æ‰‹åŠ¨æŸ¥è¯¢`),u(`div`,{class:`card-desc`},`è¾“å…¥ISBNæœç´¢`)],-1),f(n,{name:`arrow`,class:`card-arrow`})])]),f(i,{show:X.value,"onUpdate:show":t[2]||=e=>X.value=e,title:`è¾“å…¥ISBNæŸ¥è¯¢`,"show-cancel-button":``,"before-close":ye},{default:c(()=>[u(`div`,C,[f(r,{modelValue:Y.value,"onUpdate:modelValue":t[1]||=e=>Y.value=e,label:`ISBN`,placeholder:`è¯·è¾“å…¥10ä½æˆ–13ä½ISBN`,clearable:``,type:`tel`,maxlength:`13`,disabled:m(q).loading,onKeyup:ae($,[`enter`])},null,8,[`modelValue`,`disabled`])])]),_:1},8,[`show`]),m(q).loading?(b(),d(`div`,w,[f(a,{size:`32px`,vertical:``},{default:c(()=>[...t[9]||=[v(`æ­£åœ¨æŸ¥è¯¢å›¾ä¹¦ä¿¡æ¯...`,-1)]]),_:1})])):m(q).error?(b(),d(`div`,T,[f(s,{image:`error`,description:m(q).error},{default:c(()=>[f(o,{round:``,type:`primary`,onClick:be},{default:c(()=>[f(n,{name:`replay`}),t[10]||=v(` é‡æ–°æŸ¥è¯¢ `,-1)]),_:1})]),_:1},8,[`description`])])):m(q).hasResult?(b(),d(`div`,E,[u(`div`,D,[u(`div`,O,[u(`img`,{src:m(q).result.coverImage,alt:m(q).result.title,class:`book-cover`,onError:Se},null,40,k)]),u(`div`,A,[u(`h2`,j,l(m(q).result.title),1),u(`div`,M,[u(`div`,N,[f(n,{name:`friends-o`}),u(`span`,null,l(ve(m(q).result.authors)),1)]),u(`div`,P,[f(n,{name:`manager-o`}),u(`span`,null,l(m(q).result.publisher||`æœªçŸ¥å‡ºç‰ˆç¤¾`),1)]),u(`div`,F,[f(n,{name:`underway-o`}),u(`span`,null,l(m(q).result.publishedDate||`æœªçŸ¥æ—¥æœŸ`),1)])]),u(`div`,I,[t[11]||=u(`span`,{class:`isbn-label`},`ISBN`,-1),u(`span`,L,l(m(q).result.isbn),1)]),m(q).result.description?(b(),d(`div`,R,[t[12]||=u(`div`,{class:`description-title`},`ğŸ“– ç®€ä»‹`,-1),u(`div`,{class:te([`description-content`,{expanded:Z.value}])},l(m(q).result.description),3),m(q).result.description.length>100?(b(),d(`div`,{key:0,class:`expand-btn`,onClick:t[3]||=e=>Z.value=!Z.value},[v(l(Z.value?`æ”¶èµ·`:`å±•å¼€`)+` `,1),f(n,{name:Z.value?`arrow-up`:`arrow-down`},null,8,[`name`])])):_(``,!0)])):_(``,!0),u(`div`,z,[f(o,{round:``,block:``,type:`success`,size:`large`,icon:`plus`,loading:m(J).loading,onClick:Ce},{default:c(()=>[...t[13]||=[v(` æ·»åŠ åˆ°å›¾ä¹¦é¦† `,-1)]]),_:1},8,[`loading`])])])])])):(b(),d(`div`,B,[...t[14]||=[h(`<div class="empty-illustration" data-v-554498cc><div class="empty-icon" data-v-554498cc>ğŸ“–</div><div class="empty-books" data-v-554498cc><div class="book-item" style="animation-delay:0s;" data-v-554498cc>ğŸ“•</div><div class="book-item" style="animation-delay:0.1s;" data-v-554498cc>ğŸ“—</div><div class="book-item" style="animation-delay:0.2s;" data-v-554498cc>ğŸ“˜</div><div class="book-item" style="animation-delay:0.3s;" data-v-554498cc>ğŸ“™</div></div></div><h3 class="empty-title" data-v-554498cc>å¼€å§‹å½•å…¥æ‚¨çš„è—ä¹¦</h3><p class="empty-desc" data-v-554498cc>æ‰«ææ¡å½¢ç æˆ–è¾“å…¥ISBNï¼Œè½»æ¾å»ºç«‹æ‚¨çš„æ•°å­—å›¾ä¹¦é¦†</p>`,3)]])),u(`div`,V,[u(`div`,H,[f(n,{name:`info-o`,color:`#1989fa`}),t[15]||=u(`span`,null,`æ‰«æå›¾ä¹¦èƒŒé¢çš„æ¡å½¢ç å¯å¿«é€Ÿå½•å…¥`,-1)]),u(`div`,U,[f(n,{name:`bulb-o`,color:`#ff976a`}),t[16]||=u(`span`,null,`æ”¯æŒISBN-10å’ŒISBN-13æ ¼å¼`,-1)])]),u(`div`,ce,[u(`div`,{class:`debug-header`,onClick:t[4]||=e=>Q.value=!Q.value},[f(n,{name:`info-o`}),u(`span`,null,`APIè°ƒè¯•ä¿¡æ¯ `+l(m(q).debugInfo?`(æœ‰æ•°æ®)`:`(æ— æ•°æ®)`),1),f(n,{name:Q.value?`arrow-up`:`arrow-down`},null,8,[`name`])]),ne(u(`div`,W,[m(q).debugInfo?_(``,!0):(b(),d(`div`,G,[...t[17]||=[u(`div`,{class:`debug-label`},`ğŸ’¡ æç¤º:`,-1),u(`div`,{class:`debug-value`},`æŸ¥è¯¢ä¸€æœ¬å›¾ä¹¦åï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºè¯¦ç»†çš„APIè°ƒè¯•ä¿¡æ¯`,-1)]])),m(q).debugInfo?.logs?(b(),d(`div`,le,[t[18]||=u(`div`,{class:`debug-label`},`ğŸ•’ æ‰§è¡Œæ—¥å¿—:`,-1),u(`div`,ue,[(b(!0),d(g,null,ee(m(q).debugInfo.logs,(e,t)=>(b(),d(`div`,{key:t,class:`log-line`},l(e),1))),128))])])):_(``,!0),m(q).debugInfo?.requestUrl?(b(),d(`div`,de,[t[19]||=u(`div`,{class:`debug-label`},`ğŸŒ è¯·æ±‚URL:`,-1),u(`div`,fe,l(m(q).debugInfo.requestUrl),1)])):_(``,!0),m(q).debugInfo?.totalItems===void 0?_(``,!0):(b(),d(`div`,pe,[t[20]||=u(`div`,{class:`debug-label`},`ğŸ“Š ç»“æœæ•°é‡:`,-1),u(`div`,me,l(m(q).debugInfo.totalItems)+` æœ¬`,1)])),m(q).debugInfo?.responseData?(b(),d(`div`,he,[t[21]||=u(`div`,{class:`debug-label`},`ğŸ“¦ åŸå§‹å“åº”:`,-1),u(`div`,ge,[u(`pre`,null,l(JSON.stringify(m(q).debugInfo.responseData,null,2)),1)])])):_(``,!0)],512),[[p,Q.value]])])])])}}},[[`__scopeId`,`data-v-554498cc`]]);export{K as default};