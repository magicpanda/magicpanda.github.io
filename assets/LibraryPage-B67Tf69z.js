import{n as e,o as t,t as n}from"./plugin-vue_export-helper.js";import{t as r}from"./image-B9YxNmEL.js";import{At as i,Ct as a,Dt as o,Nt as s,X as c,Z as l,at as u,ct as d,dt as f,it as p,jt as m,nt as h,ot as g,st as _,ut as v,wt as y,xt as b,yt as x}from"./index-Cx_W_gHZ.js";const S=l(`filters`,{state:()=>({bookType:null,readingStatus:null,collectionStatus:null,searchQuery:``}),getters:{hasFilters:e=>!!(e.bookType||e.readingStatus||e.collectionStatus||e.searchQuery),allFilters:e=>({bookType:e.bookType,readingStatus:e.readingStatus,collectionStatus:e.collectionStatus,searchQuery:e.searchQuery}),activeFilterCount:e=>{let t=0;return e.bookType&&t++,e.readingStatus&&t++,e.collectionStatus&&t++,e.searchQuery&&t++,t}},actions:{setBookType(e){this.bookType=e},setReadingStatus(e){this.readingStatus=e},setCollectionStatus(e){this.collectionStatus=e},setSearchQuery(e){this.searchQuery=e},clearAllFilters(){this.bookType=null,this.readingStatus=null,this.collectionStatus=null,this.searchQuery=``},clearFilter(e){e===`bookType`?this.bookType=null:e===`readingStatus`?this.readingStatus=null:e===`collectionStatus`?this.collectionStatus=null:e===`searchQuery`&&(this.searchQuery=``)},setFilters(e){e.bookType!==void 0&&(this.bookType=e.bookType),e.readingStatus!==void 0&&(this.readingStatus=e.readingStatus),e.collectionStatus!==void 0&&(this.collectionStatus=e.collectionStatus),e.searchQuery!==void 0&&(this.searchQuery=e.searchQuery)}}});var C={class:`library-page`},w={class:`content`},T={key:1,class:`empty-state`},E={key:0,class:`placeholder-section`},D={class:`book-grid`},O={class:`book-cover placeholder-cover`},k={class:`book-info`},ee={class:`book-tags`},te={key:2,class:`book-grid`},A=[`onClick`],j={class:`book-info`},M={class:`book-title`},N={class:`book-authors`},P={class:`book-tags`},F=n({__name:`LibraryPage`,setup(n){let l=c(),F=e(),I=S(),L=i(!1),R=p(()=>[{text:`å…¨éƒ¨ç±»åž‹`,value:null},...F.allBookTypes.map(e=>({text:e,value:e}))]),z=[{text:`å…¨éƒ¨çŠ¶æ€`,value:null},{text:`æœªè¯»`,value:`unread`},{text:`åœ¨è¯»`,value:`reading`},{text:`å·²è¯»`,value:`finished`}],B=[{text:`å…¨éƒ¨çŠ¶æ€`,value:null},{text:`åœ¨æž¶`,value:`on_shelf`},{text:`å€Ÿå‡º`,value:`lent_out`},{text:`ä¸¢å¤±`,value:`lost`}],V=p(()=>F.filteredBooks(I.allFilters)),H=e=>!e||e.length===0?`æœªçŸ¥ä½œè€…`:e.length>2?`${e.slice(0,2).join(`, `)} ç­‰`:e.join(`, `),U=e=>({unread:`default`,reading:`primary`,finished:`success`})[e]||`default`,W=e=>({unread:`æœªè¯»`,reading:`åœ¨è¯»`,finished:`å·²è¯»`})[e]||`æœªçŸ¥`,G=e=>({on_shelf:`success`,lent_out:`warning`,lost:`danger`})[e]||`default`,K=e=>({on_shelf:`åœ¨æž¶`,lent_out:`å€Ÿå‡º`,lost:`ä¸¢å¤±`})[e]||`æœªçŸ¥`,q=()=>{V.value.length===0&&I.searchQuery&&t(`æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å›¾ä¹¦`)},J=()=>{},Y=()=>{I.clearAllFilters()},X=async()=>{await F.loadBooks(),L.value=!1,t(`åˆ·æ–°æˆåŠŸ`)},Z=()=>{l.push(`/search`)},ne=e=>{l.push(`/book/${e}`)};return x(async()=>{if(console.log(`ðŸ“š LibraryPage mounted`),console.log(`å½“å‰å›¾ä¹¦æ•°é‡:`,F.books.length),F.books.length===0){console.log(`ðŸ”„ å¼€å§‹åŠ è½½å›¾ä¹¦åˆ—è¡¨...`);let e=await F.loadBooks();console.log(`åŠ è½½ç»“æžœ:`,e),console.log(`åŠ è½½åŽå›¾ä¹¦æ•°é‡:`,F.books.length),e&&!e.success?(console.error(`âŒ åŠ è½½å¤±è´¥:`,e.error),t(`åŠ è½½å›¾ä¹¦å¤±è´¥: `+e.error)):F.books.length===0?console.log(`âœ… åŠ è½½æˆåŠŸï¼Œä½†å›¾ä¹¦é¦†æ˜¯ç©ºçš„`):console.log(`âœ… åŠ è½½æˆåŠŸï¼Œå…±`,F.books.length,`æœ¬å›¾ä¹¦`)}else console.log(`âœ… ä½¿ç”¨ç¼“å­˜çš„å›¾ä¹¦åˆ—è¡¨`)}),(e,t)=>{let n=y(`van-nav-bar`),i=y(`van-search`),c=y(`van-dropdown-item`),l=y(`van-dropdown-menu`),p=y(`van-loading`),x=y(`van-button`),S=y(`van-empty`),Q=y(`van-icon`),$=y(`van-tag`),re=y(`van-pull-refresh`);return b(),d(`div`,C,[f(n,{title:`æˆ‘çš„å›¾ä¹¦é¦†`,fixed:``}),u(`div`,w,[f(i,{modelValue:m(I).searchQuery,"onUpdate:modelValue":t[0]||=e=>m(I).searchQuery=e,placeholder:`æœç´¢ä¹¦åã€ä½œè€…æˆ–ISBN`,"show-action":``,onSearch:q},{action:o(()=>[u(`div`,{onClick:q},`æœç´¢`)]),_:1},8,[`modelValue`]),f(l,{"active-color":`#1989fa`},{default:o(()=>[f(c,{modelValue:m(I).bookType,"onUpdate:modelValue":t[1]||=e=>m(I).bookType=e,options:R.value,onChange:J},null,8,[`modelValue`,`options`]),f(c,{modelValue:m(I).readingStatus,"onUpdate:modelValue":t[2]||=e=>m(I).readingStatus=e,options:z,onChange:J},null,8,[`modelValue`]),f(c,{modelValue:m(I).collectionStatus,"onUpdate:modelValue":t[3]||=e=>m(I).collectionStatus=e,options:B,onChange:J},null,8,[`modelValue`])]),_:1}),f(re,{modelValue:L.value,"onUpdate:modelValue":t[4]||=e=>L.value=e,onRefresh:X},{default:o(()=>[m(F).loading&&!L.value?(b(),g(p,{key:0,class:`loading`,size:`24px`,vertical:``},{default:o(()=>[...t[5]||=[v(` æ­£åœ¨åŠ è½½... `,-1)]]),_:1})):V.value.length===0&&!m(F).loading?(b(),d(`div`,T,[f(S,{image:m(I).hasFilters?`search`:`default`,description:m(I).hasFilters?`æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å›¾ä¹¦`:`å›¾ä¹¦é¦†æ˜¯ç©ºçš„ï¼Œå¿«åŽ»æ·»åŠ å›¾ä¹¦å§`},{default:o(()=>[m(I).hasFilters?(b(),g(x,{key:0,type:`primary`,onClick:Y},{default:o(()=>[...t[6]||=[v(` æ¸…é™¤ç­›é€‰ `,-1)]]),_:1})):(b(),g(x,{key:1,type:`primary`,onClick:Z},{default:o(()=>[...t[7]||=[v(`åŽ»æ·»åŠ å›¾ä¹¦`,-1)]]),_:1}))]),_:1},8,[`image`,`description`]),m(I).hasFilters?_(``,!0):(b(),d(`div`,E,[t[12]||=u(`div`,{class:`placeholder-title`},`ç¤ºä¾‹å±•ç¤º`,-1),u(`div`,D,[(b(),d(h,null,a(4,e=>u(`div`,{key:e,class:`book-item placeholder`},[u(`div`,O,[f(Q,{name:`photo`,size:`48`,color:`#dcdee0`})]),u(`div`,k,[t[10]||=u(`div`,{class:`book-title placeholder-text`},`å›¾ä¹¦æ ‡é¢˜`,-1),t[11]||=u(`div`,{class:`book-authors placeholder-text`},`ä½œè€…åç§°`,-1),u(`div`,ee,[f($,{type:`default`,size:`mini`},{default:o(()=>[...t[8]||=[v(`æœªè¯»`,-1)]]),_:1}),f($,{type:`success`,size:`mini`},{default:o(()=>[...t[9]||=[v(`åœ¨æž¶`,-1)]]),_:1})])])])),64))])]))])):(b(),d(`div`,te,[(b(!0),d(h,null,a(V.value,e=>(b(),d(`div`,{key:e.id,class:`book-item`,onClick:t=>ne(e.id)},[f(m(r),{src:e.coverImage,fit:`cover`,class:`book-cover`,"lazy-load":``},{loading:o(()=>[f(p,{type:`spinner`,size:`20`})]),error:o(()=>[f(Q,{name:`photo-fail`,size:`32`})]),_:1},8,[`src`]),u(`div`,j,[u(`div`,M,s(e.title),1),u(`div`,N,s(H(e.authors)),1),u(`div`,P,[f($,{type:U(e.readingStatus),size:`mini`},{default:o(()=>[v(s(W(e.readingStatus)),1)]),_:2},1032,[`type`]),f($,{type:G(e.collectionStatus),size:`mini`},{default:o(()=>[v(s(K(e.collectionStatus)),1)]),_:2},1032,[`type`])])])],8,A))),128))]))]),_:1},8,[`modelValue`])]),f(x,{class:`floating-add-button`,round:``,type:`primary`,icon:`plus`,size:`large`,onClick:Z})])}}},[[`__scopeId`,`data-v-aa43dd31`]]);export{F as default};